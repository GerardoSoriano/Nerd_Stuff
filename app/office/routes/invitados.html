<div class="content">
  <div class="email">
    <form class="emailForm">
      <input class="toJson" type="text" name="nombre" placeholder="Juan">
      <input class="toJson" type="email" name="email" placeholder="ejemplo@correo.com">
      <input type="submit" name="send" value="Enviar">
    </form>
  </div>
  <section class="management-hierarchy">

    <h1> Mi red </h1>
    <div ng-controller="treeController" class="hv-container" style="width: 100%">
      <div class="hv-wrapper">
        <div ng-repeat="data in usuarios.invitados" ng-include="'office/templates/rama-arbol.html'"></div>
      </div>
    </div>
  </section>

</div>

<script type="text/javascript">
  $(document).ready(function () {
    $.validator.addMethod("regx", function (value, element, regexpr) {
      return regexpr.test(value);
    });

    var token = localStorage.getItem("token");

    $('form.emailForm').validate({
      debug: true,
      rules: {
        nombre: {
          required: true,
          regx: /^[a-zA-Z\s]+$/
        },
        email: {
          required: true,
          regx: /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/
        }
      },
      messages: {
        nombre: {
          required: "El nombre es requerido",
          regx: "Introduce un nombre valido"
        },
        email: {
          required: "El correo es requerido",
          regx: "Por favor ingresa un correo valido"
        }
      },
      invalidHandler: function (event, validator) {
        var errors = validator.numberOfInvalids();
        if (errors) {
          var message = errors == 1
            ? 'Tienes un campo que no cumple con lo requerido'
            : 'Tienes ' + errors + ' campos que no cumplen con lo requerido';
          alert(message);
        }
      },
      submitHandler: function (form) {
        let jsonObj = {};
        $(form).find(".toJson").each(function (key, value) {
          jsonObj[$(value).attr("name")] = $(value).val();
        });
        jsonObj['token'] = token;
        let json = JSON.stringify(jsonObj);
        $('.toJson').val('');
        $.ajax({
          method: "POST",
          url: "../server/php/controller/sendEmail.php",
          data: { "json": json }
        }).done(function (response) {
          var info = JSON.parse(response);
          console.log(info);
        }
      );
      }
    });
  });

</script>
